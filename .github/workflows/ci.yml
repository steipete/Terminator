name: AppleScript CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-applescript:
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check AppleScript syntax
      run: |
        echo "üçé Checking AppleScript syntax with osacompile..."
        
        # Check main terminator script
        echo "üìã Checking terminator.scpt..."
        osacompile -c terminator.scpt
        if [ $? -eq 0 ]; then
          echo "‚úÖ terminator.scpt syntax OK"
        else
          echo "‚ùå terminator.scpt syntax error"
          exit 1
        fi
        
        # Check test script
        echo "üìã Checking test_terminator.scpt..."
        osacompile -c test_terminator.scpt
        if [ $? -eq 0 ]; then
          echo "‚úÖ test_terminator.scpt syntax OK"
        else
          echo "‚ùå test_terminator.scpt syntax error"
          exit 1
        fi
        
        # Check cleanup script
        echo "üìã Checking cleanup_terminator_tests.scpt..."
        osacompile -c cleanup_terminator_tests.scpt
        if [ $? -eq 0 ]; then
          echo "‚úÖ cleanup_terminator_tests.scpt syntax OK"
        else
          echo "‚ùå cleanup_terminator_tests.scpt syntax error"
          exit 1
        fi
        
        echo "üéâ All AppleScript files passed syntax check!"
        
    - name: Verify script execution (dry run)
      run: |
        echo "üß™ Testing script execution (usage display)..."
        
        # Test that the main script can display usage without errors
        echo "üìã Testing terminator.scpt usage display..."
        output=$(osascript terminator.scpt 2>&1)
        if echo "$output" | grep -q "terminator.scpt"; then
          echo "‚úÖ terminator.scpt usage display works"
        else
          echo "‚ùå terminator.scpt usage display failed"
          echo "Output: $output"
          exit 1
        fi
        
        echo "üéâ Script execution test passed!"

    - name: Check for common AppleScript issues
      run: |
        echo "üîç Checking for common AppleScript issues..."
        
        # Check for proper error handling
        if grep -q "on error" *.scpt; then
          echo "‚úÖ Error handling found in scripts"
        else
          echo "‚ö†Ô∏è  No error handling found - consider adding try/catch blocks"
        fi
        
        # Check for proper quoting
        if grep -q "quoted form" *.scpt; then
          echo "‚úÖ Proper shell quoting found"
        else
          echo "‚ö†Ô∏è  No shell quoting found - ensure shell commands are properly quoted"
        fi
        
        # Check for hardcoded paths (should use variables)
        if grep -q "/tmp/" *.scpt; then
          echo "‚ÑπÔ∏è  Temporary paths found - ensure they're appropriate"
        fi
        
        echo "üéâ AppleScript quality check completed!"